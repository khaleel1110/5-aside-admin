
<main id="content" role="main" class="main" style="min-height: 88vh;">
  <div class="container pt-5" style="margin-top:3rem">
    @if (userServices.isLoading()) {
      <app-form-loading [showTabsSection]="false"></app-form-loading>
    } @else {
      <div class="mb-4">
        <div class="row align-items-center">
          <div class="col-sm mb-2 mb-sm-0">
            <h1 class="page-header-title">Add Bookings</h1>
            <p>View and manage all your bookings</p>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header border-bottom py-4">
          <h4 class="card-header-title">Basic info</h4>
        </div>
        <div class="card-body">
          <form [formGroup]="profileForm" id="bookingForm">
            <!-- Full Name -->
            <div class="row mb-4">
              <label for="firstName" class="col-sm-3 col-form-label form-label">Full name <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Displayed on public forums."></i></label>
              <div class="col-sm-9">
                <div class="input-group">
                  <input type="text" class="form-control" id="firstName" formControlName="firstName" placeholder="Clarice" aria-label="Clarice" [ngClass]="{'is-invalid': profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched}">
                  <div *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="invalid-feedback">
                    <span *ngIf="profileForm.get('firstName')?.errors?.['required']">First name is required</span>
                  </div>
                  <input type="text" class="form-control" id="lastName" formControlName="lastName" placeholder="Boone" aria-label="Boone" [ngClass]="{'is-invalid': profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched}">
                  <div *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="invalid-feedback">
                    <span *ngIf="profileForm.get('lastName')?.errors?.['required']">Last name is required</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- Email -->
            <div class="row mb-4">
              <label for="email" class="col-sm-3 col-form-label form-label">Email</label>
              <div class="col-sm-9">
                <input type="email" class="form-control" id="email" formControlName="email" placeholder="clarice@example.com" aria-label="clarice@example.com" [ngClass]="{'is-invalid': profileForm.get('email')?.invalid && profileForm.get('email')?.touched}">
                <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('email')?.errors?.['required']">Email is required</span>
                  <span *ngIf="profileForm.get('email')?.errors?.['email']">Invalid email format</span>
                </div>
              </div>
            </div>
            <!-- Phone -->
            <div class="row mb-4">
              <label for="phone" class="col-sm-3 col-form-label form-label">Phone</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="phone" formControlName="phone" placeholder="+x(xxx)xxx-xx-xx" aria-label="+x(xxx)xxx-xx-xx">
              </div>
            </div>
            <!-- Gender -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Gender</label>
              <div class="col-sm-9">
                <div class="input-group input-group-md-down-break">
                  <label class="form-control" for="genderTypeRadio1">
                    <span class="form-check">
                      <input type="radio" class="form-check-input" id="genderTypeRadio1" value="Male" formControlName="gender">
                      <span class="form-check-label">Male</span>
                    </span>
                  </label>
                  <label class="form-control" for="genderTypeRadio2">
                    <span class="form-check">
                      <input type="radio" class="form-check-input" id="genderTypeRadio2" value="Female" formControlName="gender">
                      <span class="form-check-label">Female</span>
                    </span>
                  </label>
                  <label class="form-control" for="genderTypeRadio3">
                    <span class="form-check">
                      <input type="radio" class="form-check-input" id="genderTypeRadio3" value="Other" formControlName="gender">
                      <span class="form-check-label">Other</span>
                    </span>
                  </label>
                </div>
                <div *ngIf="profileForm.get('gender')?.invalid && profileForm.get('gender')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('gender')?.errors?.['required']">Gender is required</span>
                </div>
              </div>
            </div>
            <!-- Location -->
            <div class="row mb-4">
              <label for="location" class="col-sm-3 col-form-label form-label">Location</label>
              <div class="col-sm-9">
                <select class="form-select" id="location" formControlName="location" [ngClass]="{'is-invalid': profileForm.get('location')?.invalid && profileForm.get('location')?.touched}">
                  <option value="" disabled>Select a state</option>
                  <option value="Abia">Abia</option>
                  <option value="Adamawa">Adamawa</option>
                  <option value="Akwa Ibom">Akwa Ibom</option>
                  <option value="Anambra">Anambra</option>
                  <option value="Bauchi">Bauchi</option>
                  <option value="Bayelsa">Bayelsa</option>
                  <option value="Benue">Benue</option>
                  <option value="Borno">Borno</option>
                  <option value="Cross River">Cross River</option>
                  <option value="Delta">Delta</option>
                  <option value="Ebonyi">Ebonyi</option>
                  <option value="Edo">Edo</option>
                  <option value="Ekiti">Ekiti</option>
                  <option value="Enugu">Enugu</option>
                  <option value="FCT">FCT</option>
                  <option value="Gombe">Gombe</option>
                  <option value="Imo">Imo</option>
                  <option value="Jigawa">Jigawa</option>
                  <option value="Kaduna">Kaduna</option>
                  <option value="Kano">Kano</option>
                  <option value="Katsina">Katsina</option>
                  <option value="Kebbi">Kebbi</option>
                  <option value="Kogi">Kogi</option>
                  <option value="Kwara">Kwara</option>
                  <option value="Lagos">Lagos</option>
                  <option value="Nasarawa">Nasarawa</option>
                  <option value="Niger">Niger</option>
                  <option value="Ogun">Ogun</option>
                  <option value="Ondo">Ondo</option>
                  <option value="Osun">Osun</option>
                  <option value="Oyo">Oyo</option>
                  <option value="Plateau">Plateau</option>
                  <option value="Rivers">Rivers</option>
                  <option value="Sokoto">Sokoto</option>
                  <option value="Taraba">Taraba</option>
                  <option value="Yobe">Yobe</option>
                  <option value="Zamfara">Zamfara</option>
                </select>
                <div *ngIf="profileForm.get('location')?.invalid && profileForm.get('location')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('location')?.errors?.['required']">Location is required</span>
                </div>
              </div>
            </div>
            <!-- Local Government -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Local Government</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" formControlName="localGovernment" placeholder="L.G.A" aria-label="Local government" [ngClass]="{'is-invalid': profileForm.get('localGovernment')?.invalid && profileForm.get('localGovernment')?.touched}">
                <div *ngIf="profileForm.get('localGovernment')?.invalid && profileForm.get('localGovernment')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('localGovernment')?.errors?.['required']">Local government is required</span>
                </div>
              </div>
            </div>
            <!-- Address -->
            <div class="row mb-4">
              <label for="address" class="col-sm-3 col-form-label form-label">Address line</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="address" formControlName="address" placeholder="Your address" aria-label="Your address" [ngClass]="{'is-invalid': profileForm.get('address')?.invalid && profileForm.get('address')?.touched}">
                <div *ngIf="profileForm.get('address')?.invalid && profileForm.get('address')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('address')?.errors?.['required']">Address is required</span>
                </div>
              </div>
            </div>
            <!-- Team A -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Your Team</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" formControlName="teamA" placeholder="Team A" aria-label="Team A" [ngClass]="{'is-invalid': profileForm.get('teamA')?.invalid && profileForm.get('teamA')?.touched}">
                <div *ngIf="profileForm.get('teamA')?.invalid && profileForm.get('teamA')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('teamA')?.errors?.['required']">Team A is required</span>
                </div>
              </div>
            </div>
            <!-- Team B -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Opponent Team</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" formControlName="teamB" placeholder="Team B" aria-label="Team B" [ngClass]="{'is-invalid': profileForm.get('teamB')?.invalid && profileForm.get('teamB')?.touched}">
                <div *ngIf="profileForm.get('teamB')?.invalid && profileForm.get('teamB')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('teamB')?.errors?.['required']">Team B is required</span>
                </div>
              </div>
            </div>
            <!-- Appointment Date & Time -->
            <div class="row mb-4">
              <label for="appointmentDate" class="col-sm-3 col-form-label form-label">Appointment Date & Time</label>
              <div class="col-sm-9">
                <app-date
                  (appointmentChange)="onAppointmentChange($event)"
                  [initialDate]="profileForm.get('appointmentDate')?.value ?? ''"
                  [initialStartHour]="profileForm.get('appointmentStartHour')?.value ?? null"
                  [initialDuration]="profileForm.get('appointmentDuration')?.value ?? null"
                ></app-date>
                <div *ngIf="profileForm.get('appointmentDate')?.invalid && profileForm.get('appointmentDate')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('appointmentDate')?.errors?.['required']">Appointment date is required</span>
                  <span *ngIf="profileForm.get('appointmentDate')?.errors?.['pattern']">Date must be in YYYY-MM-DD format</span>
                </div>
                <div *ngIf="profileForm.get('appointmentStartHour')?.invalid && profileForm.get('appointmentStartHour')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('appointmentStartHour')?.errors?.['required']">Appointment start time is required</span>
                </div>
                <div *ngIf="profileForm.get('appointmentDuration')?.invalid && profileForm.get('appointmentDuration')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('appointmentDuration')?.errors?.['required']">Appointment duration is required</span>
                </div>
              </div>
            </div>
            <!-- Payment Amount Display -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Total Amount</label>
              <div class="col-sm-9">
                <p class="form-text" *ngIf="profileForm.get('appointmentDuration')?.value as duration; else noDuration">
                  {{ duration * 5000 | number }} NGN
                </p>
                <ng-template #noDuration>
                  <p class="form-text">Select duration to see amount</p>
                </ng-template>
              </div>
            </div>
            <!-- Payment Method -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Payment Method</label>
              <div class="col-sm-9">
                <div class="input-group input-group-md-down-break">
                  <label class="form-control" for="paymentMethodCard">
                    <span class="form-check">
                      <input type="radio" class="form-check-input" id="paymentMethodCard" value="card" formControlName="paymentMethod">
                      <span class="form-check-label">Card (Paystack)</span>
                    </span>
                  </label>
                  <label class="form-control" for="paymentMethodCash">
                    <span class="form-check">
                      <input type="radio" class="form-check-input" id="paymentMethodCash" value="cash" formControlName="paymentMethod">
                      <span class="form-check-label">Cash/Transfer</span>
                    </span>
                  </label>
                </div>
                <div *ngIf="profileForm.get('paymentMethod')?.invalid && profileForm.get('paymentMethod')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('paymentMethod')?.errors?.['required']">Payment method is required</span>
                </div>
              </div>
            </div>
            <!-- Cash/Transfer Amount Input -->
            <div class="row mb-4" *ngIf="profileForm.get('paymentMethod')?.value === 'cash'">
              <label for="cashAmount" class="col-sm-3 col-form-label form-label">Amount Paid</label>
              <div class="col-sm-9">
                <input type="number" class="form-control" id="cashAmount" formControlName="cashAmount" placeholder="Enter amount in NGN" aria-label="Amount in NGN" [ngClass]="{'is-invalid': profileForm.get('cashAmount')?.invalid && profileForm.get('cashAmount')?.touched}">
                <div *ngIf="profileForm.get('cashAmount')?.invalid && profileForm.get('cashAmount')?.touched" class="invalid-feedback">
                  <span *ngIf="profileForm.get('cashAmount')?.errors?.['required']">Amount is required</span>
                  <span *ngIf="profileForm.get('cashAmount')?.errors?.['min']">Amount must be greater than or equal to 0</span>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="card-footer align-items-center justify-content-center">
          <button (click)="handleSubmit()" type="button" class="btn btn-primary" [disabled]="profileForm.invalid || isProcessingPayment">
            <span *ngIf="isProcessingPayment" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            {{ isProcessingPayment ? 'Processing...' : 'Confirm Booking' }}
          </button>
        </div>
      </div>
    }
  </div>
</main>
