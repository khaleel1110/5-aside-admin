<main id="content" role="main" class="main" style="min-height: 88vh;">
  <div class="container pt-5" style="margin-top:3rem">
    <div *ngIf="userServices.isLoading()">
      <app-table-loading [showTabsSection]="false"></app-table-loading>
    </div>
    <div *ngIf="!userServices.isLoading()">
      <!-- Header, Search, and Export Dropdown remain unchanged -->
      <div class="mb-4 pt-3">
        <div class="row align-items-center">
          <div class="col-sm mb-2 mb-sm-0">
            <h1 class="page-header-title">Bookings List</h1>
            <p>View and manage all your bookings</p>
          </div>
          <div class="row align-items-end">
            <div class="col-sm mb-2 mb-sm-0"></div>
            <div class="col-sm-auto m-3">
              <a class="btn btn-outline-primary" routerLink="/admin/add-booking" routerLinkActive="active">
                <i class="bi-person-add me-2"></i> Add Booking
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-none p-3">
        <div class="card-header card-header-content-md-between">
          <div class="mb-2 mb-md-0">
            <form (ngSubmit)="onSearch()">
              <div class="input-group input-group-merge input-group-flush">
                <div class="input-group-prepend input-group-text">
                  <i class="bi-search"></i>
                </div>
                <input
                  id="datatableSearch"
                  type="search"
                  class="form-control"
                  placeholder="Search bookings"
                  aria-label="Search bookings"
                  [(ngModel)]="searchTerm"
                  name="searchTerm"
                  (ngModelChange)="updateSearch()"
                />
                <button type="submit" class="btn btn-outline-white">
                  <i class="bi-search"></i> Search
                </button>
              </div>
            </form>
            <div *ngIf="selectedCount > 0" class="mt-3">
              <strong>{{ selectedCount }}</strong> Bookings selected.
            </div>
          </div>

          <div class="d-grid d-sm-flex justify-content-md-end align-items-sm-center gap-2">
            <!-- Export Dropdown (unchanged) -->
            <div class="dropdown" ngbDropdown #dropLearning="ngbDropdown">
              <button
                class="btn btn-white btn-sm w-100 dropdown-toggle"
                ngbDropdownAnchor
                (focus)="dropLearning.open()"
                role="button"
                id="usersExportDropdown"
                aria-expanded="false"
              >
                <i class="bi-download me-2"></i> Export
              </button>
              <div
                class="dropdown-menu dropdown-menu-sm-end"
                ngbDropdownMenu
                aria-labelledby="usersExportDropdown"
              >
                <span class="dropdown-header">Options</span>
                <a id="export-copy" class="dropdown-item" ngbDropdownItem href="javascript:;">
                  <img
                    class="avatar avatar-xss avatar-4x3 me-2"
                    src="/assets/svg/illustrations/copy-icon.svg"
                    alt="Image Description"
                  />
                  Copy
                </a>
                <a id="export-print" class="dropdown-item" ngbDropdownItem href="javascript:;">
                  <img
                    class="avatar avatar-xss avatar-4x3 me-2"
                    src="/assets/svg/illustrations/print-icon.svg"
                    alt="Image Description"
                  />
                  Print
                </a>
                <div class="dropdown-divider"></div>
                <span class="dropdown-header">Download options</span>
                <a id="export-excel" class="dropdown-item" ngbDropdownItem href="javascript:;">
                  <img
                    class="avatar avatar-xss avatar-4x3 me-2"
                    src="/assets/svg/brands/excel-icon.svg"
                    alt="Image Description"
                  />
                  Excel
                </a>
                <a id="export-csv" class="dropdown-item" ngbDropdownItem href="javascript:;">
                  <img
                    class="avatar avatar-xss avatar-4x3 me-2"
                    src="/assets/svg/components/placeholder-csv-format.svg"
                    alt="Image Description"
                  />
                  .CSV
                </a>
                <a id="export-pdf" class="dropdown-item" ngbDropdownItem href="javascript:;">
                  <img
                    class="avatar avatar-xss avatar-4x3 me-2"
                    src="/assets/svg/brands/pdf-icon.svg"
                    alt="Image Description"
                  />
                  PDF
                </a>
              </div>
            </div>

            <!-- Filter Dropdown -->
            <div class="dropdown" ngbDropdown #filterDropdown="ngbDropdown">
              <button
                class="btn btn-outline-primary btn-sm w-100 dropdown-toggle"
                ngbDropdownAnchor
                (focus)="filterDropdown.open()"
                id="filterDropdownButton"
                aria-expanded="false"
              >
                <i class="bi-funnel me-2"></i> Filter Bookings
                <span *ngIf="activeFilterCount > 0" class="badge bg-soft-dark text-dark rounded-circle ms-1">{{ activeFilterCount }}</span>
              </button>

              <div
                class="dropdown-menu w-100 p-3"
                style="max-width: 100%; min-width: 300px;"
                ngbDropdownMenu
                aria-labelledby="filterDropdownButton"
              >
                <form #filterForm="ngForm" (ngSubmit)="applyFilters()">
                  <!-- Date Range -->
                  <span class="dropdown-header text-uppercase mb-2 text-muted small">Date Range</span>
                  <div class="row mb-3">
                    <div class="col-sm-6 mb-2">
                      <label for="startDate" classnymi="form-label">Start Date</label>
                      <input
                        type="date"
                        class="form-control form-control-sm"
                        id="startDate"
                        name="startDate"
                        [(ngModel)]="filters.startDate"
                      />
                    </div>
                    <div class="col-sm-6 mb-2">
                      <label for="endDate" class="form-label">End Date</label>
                      <input
                        type="date"
                        class="form-control form-control-sm"
                        id="endDate"
                        name="endDate"
                        [(ngModel)]="filters.endDate"
                      />
                    </div>
                  </div>

                  <!-- Status -->
                  <span class="dropdown-header text-uppercase mb-2 text-muted small">Status</span>
                  <div class="mb-3">
                    <div class="tom-select-custom">
                      <select
                        class="form-select form-select-sm"
                        id="status"
                        name="status"
                        [(ngModel)]="filters.status"
                      >
                        <option value="">Any Status</option>
                        <option value="Played">Played</option>
                        <option value="On Progress">On Progress</option>
                        <option value="To Do">To Do</option>
                      </select>
                    </div>
                  </div>

                  <!-- Location -->
                  <span class="dropdown-header text-uppercase mb-2 text-muted small">Location</span>
                  <div class="mb-3">
                    <div class="tom-select-custom">
                      <select
                        class="form-select form-select-sm"
                        id="location"
                        name="location"
                        [(ngModel)]="filters.location"
                      >
                        <option value="">Any Location</option>
                        <option value="Abia">Abia</option>
                        <option value="Adamawa">Adamawa</option>
                        <option value="Akwa Ibom">Akwa Ibom</option>
                        <option value="Anambra">Anambra</option>
                        <option value="Bauchi">Bauchi</option>
                        <option value="Bayelsa">Bayelsa</option>
                        <option value="Benue">Benue</option>
                        <option value="Borno">Borno</option>
                        <option value="Cross River">Cross River</option>
                        <option value="Delta">Delta</option>
                        <option value="Ebonyi">Ebonyi</option>
                        <option value="Edo">Edo</option>
                        <option value="Ekiti">Ekiti</option>
                        <option value="Enugu">Enugu</option>
                        <option value="FCT">FCT</option>
                        <option value="Gombe">Gombe</option>
                        <option value="Imo">Imo</option>
                        <option value="Jigawa">Jigawa</option>
                        <option value="Kaduna">Kaduna</option>
                        <option value="Kano">Kano</option>
                        <option value="Katsina">Katsina</option>
                        <option value="Kebbi">Kebbi</option>
                        <option value="Kogi">Kogi</option>
                        <option value="Kwara">Kwara</option>
                        <option value="Lagos">Lagos</option>
                        <option value="Nasarawa">Nasarawa</option>
                        <option value="Niger">Niger</option>
                        <option value="Ogun">Ogun</option>
                        <option value="Ondo">Ondo</option>
                        <option value="Osun">Osun</option>
                        <option value="Oyo">Oyo</option>
                        <option value="Plateau">Plateau</option>
                        <option value="Rivers">Rivers</option>
                        <option value="Sokoto">Sokoto</option>
                        <option value="Taraba">Taraba</option>
                        <option value="Yobe">Yobe</option>
                        <option value="Zamfara">Zamfara</option>
                      </select>
                    </div>
                  </div>

                  <!-- Apply and Reset Buttons -->
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary btn-sm flex-grow-1">
                      <i class="bi-funnel-fill me-1"></i> Apply Filters
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm flex-grow-1" (click)="resetFilters()">
                      Reset Filters
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <!-- End Filter Dropdown -->
          </div>
        </div>

        <!-- Table -->
        <div class="table-responsive datatable-custom">
          <table
            id="datatable"
            class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
            data-hs-datatables-options='{
              "columnDefs": [{
                "targets": [0, 8],
                "orderable": false
              }],
              "order": [],
              "isResponsive": false
            }'
          >
            <thead class="thead-light">
            <tr>
              <th class="table-column-ps-1">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value=""
                    id="datatableCheckAll"
                    [checked]="allSelected"
                    (change)="selectAll($event)"
                  />
                  <label class="form-check-label" for="datatableCheckAll"></label>
                </div>
              </th>
              <th>S/N</th>
              <th>Name</th>
              <th>Appointment</th>
              <th>Time</th>
              <th>Match</th>
              <th>Status</th>
              <th>Amount</th>
              <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let user of paginatedUsers(); trackBy: trackByEmail; let i = index" class="form-control-hover-light">
              <td class="table-column-ps-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [value]="user.id"
                    [checked]="selectedUsers.has(user.id)"
                    (change)="toggleSelection(user.id)"
                  />
                  <label class="form-check-label"></label>
                </div>
              </td>
              <td>{{ (currentPage() - 1) * pageSize() + i + 1 }}</td>
              <td class="table-column-ps-0">
                <a class="d-flex align-items-center" href="@@autopath/user-profile.html">
                  <div class="avatar avatar-soft-dark avatar-circle">
                      <span class="avatar-initials">{{
                          user.appointmentDetails.firstName
                            ? user.appointmentDetails.firstName.substring(0, 2).toUpperCase()
                            : 'UN'
                        }}</span>
                  </div>
                  <div class="ms-3">
                    <span class="d-block h5 text-inherit mb-0">{{ user.fullName }}</span>
                    <span class="d-block fs-5 text-body">{{ user.appointmentDetails.email || 'N/A' }}</span>
                  </div>
                </a>
              </td>
              <td>
                üìÖ {{ user.appointmentDetails.appointmentDate | date: 'mediumDate' }}
                {{ formatTime(user.appointmentDetails.appointmentStartHour, user.appointmentDetails.appointmentDuration) }}
              </td>
              <td>‚è∞ {{ user.appointmentDetails.appointmentDuration }} hrs</td>
              <td>{{ user.appointmentDetails.teamA }} vs {{ user.appointmentDetails.teamB }}</td>
              <td>
                  <span
                    class="legend-indicator"
                    [ngClass]="{
                      'bg-success': user.status === 'Played',
                      'bg-warning': user.status === 'On Progress',
                      'bg-primary': user.status === 'To Do'
                    }"
                  ></span>{{ user.status }}
              </td>
              <td> ‚Ç¶ {{ user.appointmentDetails.amount }}</td>
              <td>
                <button type="button" class="btn btn-white btn-sm" (click)="open(user)">
                  <i class="bi bi-eye me-1"></i> View
                </button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <!-- End Table -->

        <!-- Footer -->
        <div class="card-footer">
          <div class="row justify-content-center justify-content-sm-between align-items-sm-center">
            <div class="col-sm mb-2 mb-sm-0">
              <div class="d-flex justify-content-center justify-content-sm-start align-items-center">
                <span class="text-secondary me-2">Total:</span>
                <span>{{ totalItems() }}</span>
              </div>
            </div>
            <div class="col-sm-auto">
              <app-pagination
                [totalItems]="totalItems()"
                [currentPage]="currentPage()"
                [pageSize]="pageSize()"
                [pageSizeOptions]="[5, 10, 15, 20]"
                (pageChange)="onPageChange($event)"
                (pageSizeChange)="onPageSizeChange($event)"
              ></app-pagination>
            </div>
          </div>
        </div>
        <!-- End Footer -->
      </div>
    </div>
  </div>
</main>
